var edButtons=new Array(),edLinks=new Array(),edOpenTags=new Array(),now=new Date(),datetime;function edButton(f,e,c,b,a,d){this.id=f;this.display=e;this.tagStart=c;this.tagEnd=b;this.access=a;this.open=d}function zeroise(b,a){var c=b.toString();if(b<0){c=c.substr(1,c.length)}while(c.length<a){c="0"+c}if(b<0){c="-"+c}return c}datetime=now.getUTCFullYear()+"-"+zeroise(now.getUTCMonth()+1,2)+"-"+zeroise(now.getUTCDate(),2)+"T"+zeroise(now.getUTCHours(),2)+":"+zeroise(now.getUTCMinutes(),2)+":"+zeroise(now.getUTCSeconds(),2)+"+00:00";edButtons[edButtons.length]=new edButton("ed_strong","b","<strong>","</strong>","b");edButtons[edButtons.length]=new edButton("ed_em","i","<em>","</em>","i");edButtons[edButtons.length]=new edButton("ed_link","link","","</a>","a");edButtons[edButtons.length]=new edButton("ed_block","b-quote","\n\n<blockquote>","</blockquote>\n\n","q");edButtons[edButtons.length]=new edButton("ed_del","del",'<del datetime="'+datetime+'">',"</del>","d");edButtons[edButtons.length]=new edButton("ed_ins","ins",'<ins datetime="'+datetime+'">',"</ins>","s");edButtons[edButtons.length]=new edButton("ed_img","img","","","m",-1);edButtons[edButtons.length]=new edButton("ed_ul","ul","<ul>\n","</ul>\n\n","u");edButtons[edButtons.length]=new edButton("ed_ol","ol","<ol>\n","</ol>\n\n","o");edButtons[edButtons.length]=new edButton("ed_li","li","\t<li>","</li>\n","l");edButtons[edButtons.length]=new edButton("ed_code","code","<code>","</code>","c");edButtons[edButtons.length]=new edButton("ed_more","more","<!--more-->","","t",-1);function edLink(){this.display="";this.URL="";this.newWin=0}edLinks[edLinks.length]=new edLink("WordPress","http://wordpress.org/");edLinks[edLinks.length]=new edLink("alexking.org","http://www.alexking.org/");function edShowButton(b,a){if(b.id=="ed_img"){document.write('<input type="button" id="'+b.id+'" accesskey="'+b.access+'" class="ed_button" onclick="edInsertImage(edCanvas);" value="'+b.display+'" />')}else{if(b.id=="ed_link"){document.write('<input type="button" id="'+b.id+'" accesskey="'+b.access+'" class="ed_button" onclick="edInsertLink(edCanvas, '+a+');" value="'+b.display+'" />')}else{document.write('<input type="button" id="'+b.id+'" accesskey="'+b.access+'" class="ed_button" onclick="edInsertTag(edCanvas, '+a+');" value="'+b.display+'"  />')}}}function edShowLinks(){var a='<select onchange="edQuickLink(this.options[this.selectedIndex].value, this);"><option value="-1" selected>'+quicktagsL10n.quickLinks+"</option>",b;for(b=0;b<edLinks.length;b++){a+='<option value="'+b+'">'+edLinks[b].display+"</option>"}a+="</select>";document.write(a)}function edAddTag(a){if(edButtons[a].tagEnd!=""){edOpenTags[edOpenTags.length]=a;document.getElementById(edButtons[a].id).value="/"+document.getElementById(edButtons[a].id).value}}function edRemoveTag(b){for(var a=0;a<edOpenTags.length;a++){if(edOpenTags[a]==b){edOpenTags.splice(a,1);document.getElementById(edButtons[b].id).value=document.getElementById(edButtons[b].id).value.replace("/","")}}}function edCheckOpenTags(c){var a=0,b;for(b=0;b<edOpenTags.length;b++){if(edOpenTags[b]==c){a++}}if(a>0){return true}else{return false}}function edCloseAllTags(){var a=edOpenTags.length,b;for(b=0;b<a;b++){edInsertTag(edCanvas,edOpenTags[edOpenTags.length-1])}}function edQuickLink(c,d){if(c>-1){var b="",a;if(edLinks[c].newWin==1){b=' target="_blank"'}a='<a href="'+edLinks[c].URL+'"'+b+">"+edLinks[c].display+"</a>";d.selectedIndex=0;edInsertContent(edCanvas,a)}else{d.selectedIndex=0}}function edSpell(c){var e="",d,b,a;if(document.selection){c.focus();d=document.selection.createRange();if(d.text.length>0){e=d.text}}else{if(c.selectionStart||c.selectionStart=="0"){b=c.selectionStart;a=c.selectionEnd;if(b!=a){e=c.value.substring(b,a)}}}if(e==""){e=prompt(quicktagsL10n.wordLookup,"")}if(e!==null&&/^\w[\w ]*$/.test(e)){window.open("http://www.answers.com/"+escape(e))}}function edToolbar(){document.write('<div id="ed_toolbar">');for(var a=0;a<edButtons.length;a++){edShowButton(edButtons[a],a)}document.write("</div>")}function edInsertTag(d,c){if(document.selection){d.focus();var e=document.selection.createRange();if(e.text.length>0){e.text=edButtons[c].tagStart+e.text+edButtons[c].tagEnd}else{if(!edCheckOpenTags(c)||edButtons[c].tagEnd==""){e.text=edButtons[c].tagStart;edAddTag(c)}else{e.text=edButtons[c].tagEnd;edRemoveTag(c)}}d.focus()}else{if(d.selectionStart||d.selectionStart=="0"){var b=d.selectionStart,a=d.selectionEnd,g=a,f=d.scrollTop;if(b!=a){d.value=d.value.substring(0,b)+edButtons[c].tagStart+d.value.substring(b,a)+edButtons[c].tagEnd+d.value.substring(a,d.value.length);g+=edButtons[c].tagStart.length+edButtons[c].tagEnd.length}else{if(!edCheckOpenTags(c)||edButtons[c].tagEnd==""){d.value=d.value.substring(0,b)+edButtons[c].tagStart+d.value.substring(a,d.value.length);edAddTag(c);g=b+edButtons[c].tagStart.length}else{d.value=d.value.substring(0,b)+edButtons[c].tagEnd+d.value.substring(a,d.value.length);edRemoveTag(c);g=b+edButtons[c].tagEnd.length}}d.focus();d.selectionStart=g;d.selectionEnd=g;d.scrollTop=f}else{if(!edCheckOpenTags(c)||edButtons[c].tagEnd==""){d.value+=edButtons[c].tagStart;edAddTag(c)}else{d.value+=edButtons[c].tagEnd;edRemoveTag(c)}d.focus()}}}function edInsertContent(d,c){var e,b,a,f;if(document.selection){d.focus();e=document.selection.createRange();e.text=c;d.focus()}else{if(d.selectionStart||d.selectionStart=="0"){b=d.selectionStart;a=d.selectionEnd;f=d.scrollTop;d.value=d.value.substring(0,b)+c+d.value.substring(a,d.value.length);d.focus();d.selectionStart=b+c.length;d.selectionEnd=b+c.length;d.scrollTop=f}else{d.value+=c;d.focus()}}}function edInsertLink(d,c,b){if(!b){b="http://"}if(!edCheckOpenTags(c)){var a=prompt("\u8bf7\u8f93\u5165\u94fe\u63a5\u5730\u5740:",b);if(a){edButtons[c].tagStart='<a href="'+a+'">';edInsertTag(d,c)}}else{edInsertTag(d,c)}}function edInsertImage(b){var a=prompt("\u8bf7\u8f93\u5165\u56fe\u7247\u5730\u5740:","http://");if(a){a='<img src="'+a+'" alt="'+prompt("\u8bf7\u8f93\u5165\u56fe\u7247\u63cf\u8ff0","")+'" />';edInsertContent(b,a)}}var QTags=function(a,c,b,g){var l=this,m=document.getElementById(b),j,n,f,k,d;l.Buttons=[];l.Links=[];l.OpenTags=[];l.Canvas=document.getElementById(c);if(!l.Canvas||!m){return}g=(typeof g!="undefined")?","+g+",":"";l.edShowButton=function(p,o){if(g&&(g.indexOf(","+p.display+",")!=-1)){return""}else{if(p.id==a+"_img"){return'<input type="button" id="'+p.id+'" accesskey="'+p.access+'" class="ed_button" onclick="edInsertImage('+a+'.Canvas);" value="'+p.display+'" />'}else{if(p.id==a+"_link"){return'<input type="button" id="'+p.id+'" accesskey="'+p.access+'" class="ed_button" onclick="'+a+".edInsertLink("+o+');" value="'+p.display+'" />'}else{return'<input type="button" id="'+p.id+'" accesskey="'+p.access+'" class="ed_button" onclick="'+a+".edInsertTag("+o+');" value="'+p.display+'" />'}}}};l.edAddTag=function(i){if(l.Buttons[i].tagEnd!=""){l.OpenTags[l.OpenTags.length]=i;document.getElementById(l.Buttons[i].id).value="/"+document.getElementById(l.Buttons[i].id).value}};l.edRemoveTag=function(i){for(j=0;j<l.OpenTags.length;j++){if(l.OpenTags[j]==i){l.OpenTags.splice(j,1);document.getElementById(l.Buttons[i].id).value=document.getElementById(l.Buttons[i].id).value.replace("/","")}}};l.edCheckOpenTags=function(p){n=0;for(var o=0;o<l.OpenTags.length;o++){if(l.OpenTags[o]==p){n++}}if(n>0){return true}else{return false}};this.edCloseAllTags=function(){var i=l.OpenTags.length;for(var p=0;p<i;p++){l.edInsertTag(l.OpenTags[l.OpenTags.length-1])}};this.edQuickLink=function(q,r){if(q>-1){var p="",o;if(Links[q].newWin==1){p=' target="_blank"'}o='<a href="'+Links[q].URL+'"'+p+">"+Links[q].display+"</a>";r.selectedIndex=0;edInsertContent(l.Canvas,o)}else{r.selectedIndex=0}};l.edInsertTag=function(q){if(document.selection){l.Canvas.focus();d=document.selection.createRange();if(d.text.length>0){d.text=l.Buttons[q].tagStart+d.text+l.Buttons[q].tagEnd}else{if(!l.edCheckOpenTags(q)||l.Buttons[q].tagEnd==""){d.text=l.Buttons[q].tagStart;l.edAddTag(q)}else{d.text=l.Buttons[q].tagEnd;l.edRemoveTag(q)}}l.Canvas.focus()}else{if(l.Canvas.selectionStart||l.Canvas.selectionStart=="0"){var p=l.Canvas.selectionStart,o=l.Canvas.selectionEnd,s=o,r=l.Canvas.scrollTop;if(p!=o){l.Canvas.value=l.Canvas.value.substring(0,p)+l.Buttons[q].tagStart+l.Canvas.value.substring(p,o)+l.Buttons[q].tagEnd+l.Canvas.value.substring(o,l.Canvas.value.length);s+=l.Buttons[q].tagStart.length+l.Buttons[q].tagEnd.length}else{if(!l.edCheckOpenTags(q)||l.Buttons[q].tagEnd==""){l.Canvas.value=l.Canvas.value.substring(0,p)+l.Buttons[q].tagStart+l.Canvas.value.substring(o,l.Canvas.value.length);l.edAddTag(q);s=p+l.Buttons[q].tagStart.length}else{l.Canvas.value=l.Canvas.value.substring(0,p)+l.Buttons[q].tagEnd+l.Canvas.value.substring(o,l.Canvas.value.length);l.edRemoveTag(q);s=p+l.Buttons[q].tagEnd.length}}l.Canvas.focus();l.Canvas.selectionStart=s;l.Canvas.selectionEnd=s;l.Canvas.scrollTop=r}else{if(!l.edCheckOpenTags(q)||l.Buttons[q].tagEnd==""){l.Canvas.value+=Buttons[q].tagStart;l.edAddTag(q)}else{l.Canvas.value+=Buttons[q].tagEnd;l.edRemoveTag(q)}l.Canvas.focus()}}};this.edInsertLink=function(q,p){if(!p){p="http://"}if(!l.edCheckOpenTags(q)){var o=prompt("\u8bf7\u8f93\u5165\u94fe\u63a5\u5730\u5740:",p);if(o){l.Buttons[q].tagStart='<a href="'+o+'">';l.edInsertTag(q)}}else{l.edInsertTag(q)}};this.edInsertImage=function(){var i=prompt("\u8bf7\u8f93\u5165\u56fe\u7247\u5730\u5740:","http://");if(i){i='<img src="'+i+'" alt="'+prompt("\u8bf7\u8f93\u5165\u56fe\u7247\u63cf\u8ff0:","")+'" />';edInsertContent(l.Canvas,i)}};l.Buttons[l.Buttons.length]=new edButton(a+"_strong","b","<strong>","</strong>","b");l.Buttons[l.Buttons.length]=new edButton(a+"_p","p","<p>","</p>","p");l.Buttons[l.Buttons.length]=new edButton(a+"_hr","hr","<hr/>","","m",-1);l.Buttons[l.Buttons.length]=new edButton(a+"_em","i","<em>","</em>","i");l.Buttons[l.Buttons.length]=new edButton(a+"_link","link","","</a>","a");l.Buttons[l.Buttons.length]=new edButton(a+"_block","b-quote","\n\n<blockquote>","</blockquote>\n\n","q");l.Buttons[l.Buttons.length]=new edButton(a+"_del","del",'<del datetime="'+datetime+'">',"</del>","d");l.Buttons[l.Buttons.length]=new edButton(a+"_ins","ins",'<ins datetime="'+datetime+'">',"</ins>","s");l.Buttons[l.Buttons.length]=new edButton(a+"_img","img","","","m",-1);l.Buttons[l.Buttons.length]=new edButton(a+"_ul","ul","<ul>\n","</ul>\n\n","u");l.Buttons[l.Buttons.length]=new edButton(a+"_ol","ol","<ol>\n","</ol>\n\n","o");l.Buttons[l.Buttons.length]=new edButton(a+"_li","li","\t<li>","</li>\n","l");l.Buttons[l.Buttons.length]=new edButton(a+"_code","code","<code>","</code>","c");l.Buttons[l.Buttons.length]=new edButton(a+"_more","more","<!--more-->","","t",-1);f=document.createElement("div");f.id=a+"_qtags";k='<div id="'+a+'_toolbar">';for(j=0;j<l.Buttons.length;j++){k+=l.edShowButton(l.Buttons[j],j)}var e="\u5173\u95ed\u6240\u6709\u6807\u7b7e";var h="/closeAllTags";k+='<input type="button" id="'+a+'_ed_close" class="ed_button" onclick="'+a+'.edCloseAllTags();" title="'+e+'" value="'+h+'" />';k+="</div>";f.innerHTML=k;m.parentNode.insertBefore(f,m)};
